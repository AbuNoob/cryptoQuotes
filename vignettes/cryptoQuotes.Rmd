---
title: "Getting Cryptocurrency Market Data in R"
subtitle: "What happens when Elon Musk Tweets about Dogecoin?"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Crypto prices in R}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(cryptoQuotes)
```

This library provides access to recent, and historical, crypto prices from various centralized exchanges using a high level unified API. It supports perpetual futures and spot markets, with varying time intervals.

In this vignette, we will show how the ```ATOMUSDT```-pair can be retrieved from Binance and Kucoin for the futures and spot market, and how these prices can plotted with the most common charts and indicators

### Binance futures market

```{r, eval=FALSE}
## get OHLC data
## from binance futures
## market with daily pips
ATOMUSDT <- cryptoQuotes::getQuote(
  ticker   = 'ATOMUSDT',
  source   = 'binance',
  futures  = TRUE,
  interval = '15m',
  from     = '2023-01-01',
  to       = '2023-01-02'
)
```

The USDT denominated ATOM, can be charted directly via the `chart`-function, for a quick overview.

```{r, out.width="100%",fig.align='center',fig.height=5}
## Create a chart
cryptoQuotes::chart(
  cryptoQuotes::kline(ATOMUSDT, deficiency = FALSE) %>%
    cryptoQuotes::addVolume() %>% 
    cryptoQuotes::addBBands(cols = c('close'))
)
```


### Elon Musk tweeting about Dogecoin

At January 14, 06.18 (UTC) Elon Musk tweets about Dogecoin (DOGE)

<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Tesla merch buyable with Dogecoin</p>&mdash; Elon Musk (@elonmusk) <a href="https://twitter.com/elonmusk/status/1481873421390680065?ref_src=twsrc%5Etfw">January 14, 2022</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

To analyze the price action of Dogecoin following Elon Musks's tweet we could extract the price in ```1m``` intervals, between 06.00 and 07.00. As the returned quotes are just `xts`-objects the subsetting can be done using ```window```.

```{r, eval=FALSE}
## 1) extract
## DOGEUSDT the day
## of the tweet on the
## 1m chart
DOGEUSDT <-  cryptoQuotes::getQuote(
  ticker = 'DOGEUSDT',
  interval = '1m',
  futures = FALSE,
  from = '2022-01-14',
  to   = '2022-01-15'
)

## 2) extract the hour
## of the tweet
DOGEUSDT <- window(
  DOGEUSDT,
  start = ('2022-01-14 06:00:00'),
  end = ('2022-01-14 07:00:00')
)
```
We can add events to the charts using ```addEvents```. As the data, in this case, is `1m` intervals between 06.00 and 07.00, we can subset by row number, and convert the event data to a ```data.frame```, 

```{r}
## 1) create event data.frame
## by subsetting the data
event_data <- as.data.frame(
  zoo::coredata(
    DOGEUSDT[19]
    )
)

## 1.1) add the index 
## to the event_data
event_data$index <- zoo::index(
  DOGEUSDT[19]
)

# 1.2) add event label
# to the data
event_data$event <- 'Elon Musk Tweets'

# 1.3) add color to the
# event label
event_data$color <- 'steelblue'
```

The eventlines can be added to the ```chart``` as follows,

```{r, out.width="100%",fig.align='center',fig.height=5}
## 1) chart the
## price action
## using klines
cryptoQuotes::chart(
  chart = cryptoQuotes::kline(
    quote = DOGEUSDT
  )%>% addEvents(
    event = event_data
  ) %>% cryptoQuotes::addVolume(),
  slider = FALSE
)
```

Within the minute of the Elon Musks tweet, Dogecoin closed at `r DOGEUSDT[19]$Close`, rallying `r paste0(round((DOGEUSDT[19]$Close/DOGEUSDT[19]$Open - 1) * 100,2), '%')`.
